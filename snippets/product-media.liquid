{% doc %}
  Renders product media (images, videos, models) with responsive handling and optimized performance.

  @param {media} media - The media object to render

  @example
  {% render 'product-media', media: product.featured_media, priority: true %}
  {% render 'product-media', media: variant.featured_media, class: 'product__media' %}
{% enddoc %}

{% liquid
  assign poster = media.preview_image | image_url: width: 1200, height: 800, crop: 'center'
  assign widths_list = '320,640,960,1280,1600'
  assign alt_text = media.alt | default: product.title | escape
%}

{% case media.media_type %}
  {% when 'image' %}
    {{
      media
      | image_url: width: 1600
      | image_tag:
        alt: alt_text,
        loading: 'eager',
        fetchpriority: 'high',
        decoding: 'async',
        widths: widths_list,
        sizes: '100vw',
        class: 'block w-full h-auto object-contain'
    }}
  {% when 'video' %}
    {{
      media
      | video_tag:
        class: 'w-full h-full object-cover',
        controls: true,
        playsinline: true,
        preload: 'metadata',
        poster: poster
    }}
  {% when 'external_video' %}
    {{ media | external_video_tag: class: 'w-full h-full object-cover', loading: 'lazy' }}
  {% when 'model' %}
    {{
      media
      | model_viewer_tag: class: 'w-full h-full', reveal: 'interaction', ar: true, camera_controls: true, poster: poster
    }}
  {% else %}
    <div class="text-sm text-neutral-500 p-4">{{ 'products.media.unsupported' }}</div>
{% endcase %}
